<html><head><base href="." />
<title>Telegram Bot - Dice Game 21</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@300;400;500;700&display=swap');
    body {
        font-family: 'Rajdhani', sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #000428, #003366);
        color: #fff;
    }
    .container {
        max-width: 800px;
        margin: 0 auto;
        background: linear-gradient(135deg, #0a1930, #142747);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        position: relative;
        overflow: hidden;
        z-index: 1;
    }
    
    #diceContainer {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        padding: 10px;
        position: relative;
        z-index: 2;
    }

    .dice {
        width: 60px;
        height: 60px;
        animation: rollIn 0.5s ease-out;
    }

    @keyframes rollIn {
        0% {
            transform: rotateZ(-180deg) scale(0);
            opacity: 0;
        }
        100% {
            transform: rotateZ(0) scale(1);
            opacity: 1;
        }
    }

    .dice.static {
        animation: none;
    }
    .container::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 200%;
        top: 0;
        left: 0;
        z-index: -1;
        pointer-events: none;
        background-image: 
            /* Original 15 fireflies */
            radial-gradient(3px 3px at 20px 30px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 140px 170px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 260px 90px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 380px 210px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 500px 130px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 600px 250px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 700px 300px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 100px 350px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 300px 400px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 450px 450px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 550px 300px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 650px 350px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 750px 400px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 200px 450px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 400px 500px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            /* 20 new static fireflies */
            radial-gradient(3px 3px at 50px 80px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 180px 120px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 320px 160px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 420px 240px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 580px 180px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 680px 220px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 150px 280px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 250px 320px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 480px 360px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 520px 400px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 620px 280px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 720px 330px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 80px 420px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 280px 380px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 350px 420px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 450px 380px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 550px 420px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 650px 380px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(3px 3px at 750px 420px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0)),
            radial-gradient(4px 4px at 780px 380px, rgba(255, 255, 150, 0.8), rgba(0,0,0,0));
        background-repeat: no-repeat;
        /* Removed animation for static fireflies */
        filter: blur(0.5px);
    }

    @keyframes fireflyMove {
        0% {
            opacity: 0;
            transform: translate(0, 0);
        }
        10% {
            opacity: 1;
        }
        25% {
            transform: translate(100px, -50px);
        }
        40% {
            transform: translate(-75px, 100px);
        }
        60% {
            transform: translate(150px, -120px);
        }
        75% {
            transform: translate(-100px, 75px);
        }
        90% {
            opacity: 1;
        }
        100% {
            opacity: 0;
            transform: translate(0, 0);
        }
    }

    @keyframes starWander {
        0% {
            transform: translateX(0) rotate(0deg);
        }
        25% {
            transform: translateX(15px) rotate(0.5deg);
        }
        50% {
            transform: translateX(-15px) rotate(-0.5deg);
        }
        75% {
            transform: translateX(10px) rotate(0.25deg);
        }
        100% {
            transform: translateX(-10px) rotate(-0.25deg);
        }
    }

    @keyframes twinkle {
        0% { 
            transform: translateY(0);
            opacity: 0;
        }
        25% {
            opacity: 0.4;
        }
        50% {
            opacity: 0;
        }
        100% { 
            transform: translateY(-100px);
            opacity: 0.4;
        }
    }
    h1 {
        text-align: center;
        font-size: 36px;
        margin: 20px 0;
        background: linear-gradient(45deg, #00f2ff, #ff00f7);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
        position: relative;
        z-index: 2;
    }
    #target {
        font-size: 48px;
        text-align: center;
        margin: 20px 0;
        color: transparent;
        background: linear-gradient(45deg, #00f2ff, #ff00f7);
        -webkit-background-clip: text;
        background-clip: text;
        text-shadow: 
            -1px -1px 0 #000,
            1px -1px 0 #000,
            -1px 1px 0 #000,
            1px 1px 0 #000,
            0 0 20px #00f2ff,
            0 0 40px #ff00f7;
        font-weight: bold;
        font-family: 'Orbitron', sans-serif;
        position: relative;
        z-index: 2;
    }
    #score {
        font-size: 24px;
        margin: 20px 0;
        font-family: 'Orbitron', sans-serif;
        position: relative;
        z-index: 2;
    }
    button {
        background: #4CAF50;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 4px;
        transition: background 0.3s;
        font-family: 'Rajdhani', sans-serif;
        font-weight: 500;
        position: relative;
        z-index: 2;
    }
    button:hover {
        background: #45a049;
    }
    button:disabled {
        background: #cccccc;
        cursor: not-allowed;
    }
    .result {
        font-size: 20px;
        margin-top: 20px;
        padding: 10px;
        border-radius: 4px;
        position: relative;
        z-index: 2;
    }
    .win {
        background: #4CAF50;
        animation: pulseWin 1s infinite;
    }
    .lose {
        background: #f44336;
        animation: pulseLose 1s infinite;
    }
    @keyframes pulseWin {
        0% { background: #4CAF50; }
        50% { background: #45a049; }
        100% { background: #4CAF50; }
    }
    @keyframes pulseLose {
        0% { background: #f44336; }
        50% { background: #d32f2f; }
        100% { background: #f44336; }
    }
    .eth-button {
        background: linear-gradient(45deg, #00f2ff, #ff00f7);
        color: white;
        padding: 15px 30px;  
        border: none;
        border-radius: 25px;
        font-size: 20px;     
        margin-top: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        transition: all 0.3s ease;
        box-shadow: 0 0 20px rgba(0, 242, 255, 0.4);
        width: 100%;
        max-width: 300px;    
        margin: 20px auto;
        position: relative;
        z-index: 2;
    }
    .eth-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 30px rgba(255, 0, 247, 0.6);
    }
    .eth-logo {
        width: 20px;
        height: 20px;
    }
    .wallet-status {
        color: #4CAF50;
        font-size: 14px;
        margin-top: 10px;
        text-align: center;
        font-family: 'Rajdhani', sans-serif;
        position: relative;
        z-index: 2;
    }
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        backdrop-filter: blur(5px);
    }
    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
        padding: 15px;    
        border-radius: 15px;
        box-shadow: 0 0 30px rgba(0, 242, 255, 0.3);
        border: 2px solid #00f2ff;
        max-width: 300px;  
        width: 80%;        
    }
    .close-modal {
        position: absolute;
        right: 15px;
        top: 15px;
        font-size: 24px;
        color: #fff;
        cursor: pointer;
        transition: color 0.3s;
    }
    .close-modal:hover {
        color: #ff00f7;
    }
    .deposit-input {
        width: calc(100% - 30px);  
        padding: 10px;             
        margin: 10px 0;            
        border: 2px solid #00f2ff;
        border-radius: 8px;
        background: rgba(0, 242, 255, 0.1);
        color: white;
        font-size: 16px;           
        transition: all 0.3s;
    }
    .deposit-input:focus {
        border-color: #ff00f7;
        box-shadow: 0 0 15px rgba(255, 0, 247, 0.3);
        outline: none;
    }
    .withdraw-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid rgba(0, 242, 255, 0.3);
    }
    .deposit-button {
        background: linear-gradient(45deg, #00f2ff, #ff00f7);
        color: white;
        padding: 15px 32px;
        border: none;
        border-radius: 25px;
        font-size: 18px;
        margin-top: 20px;
        cursor: pointer;
        width: 100%;
        transition: all 0.3s ease;
        box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
        font-family: 'Rajdhani', sans-serif;
    }
    .deposit-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 30px rgba(255, 0, 247, 0.5);
    }
</style>
</head>
<body>
<div class="container">
    <div id="target">Objetivo: **</div>
    <h1>🎲 Lucky 21 🎲</h1>
    <div id="score">Score: 0</div>
    <div id="diceContainer"></div>
    <button onclick="rollDice()" id="rollButton" disabled>Roll Dice</button>
    <button onclick="stand()" id="standButton" disabled>Stand</button>
    <button onclick="resetGame()" id="newGameButton" disabled>New Game</button>
    <div id="result" class="result"></div>
    <div id="walletStatus" class="wallet-status"></div>
    <button onclick="toggleWallet()" class="eth-button" id="walletButton">    
        <svg class="eth-logo" viewBox="0 0 32 32">
            <path fill="white" d="M16 2l-4 12 4 2 4-2-4-12z"/>
            <path fill="white" d="M16 18l-4-2v6l4 6 4-6v-6l-4 2z"/>
        </svg>
        <div style="display: flex; flex-direction: column; align-items: center;">
            <span id="walletButtonText">Connect Wallet</span>
            <span id="ethBalance" style="font-size: 0.8em; margin-top: 5px;"></span>
        </div>
    </button>
    <button onclick="openModal()" class="eth-button">Deposit ETH</button>
</div>
<div id="depositModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <h2 style="color: #00f2ff; text-align: center; font-family: 'Orbitron', sans-serif;">Deposit ETH</h2>
        <input type="number" id="depositAmount" class="deposit-input" placeholder="Enter ETH amount" step="0.01" min="0.01">
        <button onclick="depositCustomAmount()" class="deposit-button" id="depositButton">
            Send ETH
        </button>
    </div>
</div>
<script>
const TelegramBot = {
    currentScore: 0,
    gameActive: false,
    targetScore: 21,

    init() {
        document.getElementById('target').textContent = 'Objetivo: **';
        this.updateDisplay();
        this.updateButtons();
    },

    rollDice() {
        if (!isWalletConnected) {
            alert('Please connect your wallet to play!');
            return;
        }
        if (!this.gameActive) return;
        
        const randomValue = Math.random();
        let dice;
        
        if (randomValue < 0.1) {
            dice = this.targetScore - this.currentScore;
            if (dice > 6) dice = Math.floor(Math.random() * 6) + 1;
        } else if (randomValue < 0.5) {
            const remainingToTarget = this.targetScore - this.currentScore;
            if (remainingToTarget > 6) {
                dice = Math.floor(Math.random() * 4) + 1;
            } else {
                dice = Math.min(remainingToTarget - 1, Math.floor(Math.random() * 6) + 1);
            }
        } else {
            const remainingToTarget = this.targetScore - this.currentScore;
            if (remainingToTarget > 6) {
                dice = Math.floor(Math.random() * 6) + 1;
            } else {
                dice = Math.min(6, remainingToTarget + Math.floor(Math.random() * 3) + 1);
            }
        }

        dice = Math.max(1, Math.min(6, Math.floor(dice)));

        this.currentScore += dice;
        this.displayDice(dice);
        this.updateDisplay();
        this.checkGameStatus();
    },

    stand() {
        if (!isWalletConnected) {
            alert('Please connect your wallet to play!');
            return;
        }
        if (!this.gameActive) return;
        this.gameActive = false;
        const resultDiv = document.getElementById('result');
        
        if (this.currentScore >= this.targetScore) {
            resultDiv.textContent = `¡Has ganado! Tu puntuación: ${this.currentScore}`;
            resultDiv.className = 'result win';
        } else {
            resultDiv.textContent = `¡Has perdido! Te faltaron puntos. Tu puntuación: ${this.currentScore}`;
            resultDiv.className = 'result lose';
        }
        document.getElementById('newGameButton').disabled = false;
        this.updateButtons();
    },

    displayDice(value) {
        const diceContainer = document.getElementById('diceContainer');
        const diceDots = this.getDiceDots(value);
        const diceSVG = `
            <svg class="dice" viewBox="0 0 100 100" onanimationend="this.classList.add('static')">
                <defs>
                    <linearGradient id="diceGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#00f2ff;stop-opacity:0.3"/>
                        <stop offset="100%" style="stop-color:#ff00f7;stop-opacity:0.3"/>
                    </linearGradient>
                    <filter id="bevel">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="2" result="blur"/>
                        <feSpecularLighting in="blur" surfaceScale="5" specularConstant="1.5" 
                                          specularExponent="20" lighting-color="#ffffff"  
                                          result="specOut">
                            <fePointLight x="-5000" y="-10000" z="20000"/>
                        </feSpecularLighting>
                        <feComposite in="specOut" in2="SourceAlpha" operator="in" result="specOut2"/>
                        <feComposite in="SourceGraphic" in2="specOut2" operator="arithmetic" 
                                    k1="0" k2="1" k3="1" k4="0"/>
                    </filter>
                </defs>
                <rect x="5" y="5" width="90" height="90" rx="10" fill="url(#diceGrad)" 
                      stroke="white" stroke-width="3" filter="url(#bevel)"/>
                ${diceDots}
            </svg>
        `;
        diceContainer.innerHTML += diceSVG;
    },

    getDiceDots(value) {
        const dotConfigurations = {
            1: ['50,50'],
            2: ['30,30', '70,70'],
            3: ['30,30', '50,50', '70,70'],
            4: ['30,30', '30,70', '70,30', '70,70'],
            5: ['30,30', '30,70', '50,50', '70,30', '70,70'],
            6: ['30,30', '30,50', '30,70', '70,30', '70,50', '70,70']
        };

        const dots = dotConfigurations[value] || dotConfigurations[1];
        return dots.map(pos => {
            const [cx, cy] = pos.split(',');
            return `<circle cx="${cx}" cy="${cy}" r="5" fill="white" 
                    filter="drop-shadow(0 0 3px #00f2ff) drop-shadow(0 0 2px #ff00f7)"/>`;
        }).join('');
    },

    updateDisplay() {
        document.getElementById('score').textContent = `Score: ${this.currentScore}`;
    },

    updateButtons() {
        const walletConnected = isWalletConnected;
        document.getElementById('rollButton').disabled = !this.gameActive || !walletConnected;
        document.getElementById('standButton').disabled = !this.gameActive || !walletConnected;
        document.getElementById('newGameButton').disabled = (this.gameActive || !walletConnected);
    },

    checkGameStatus() {
        const resultDiv = document.getElementById('result');
        if (this.currentScore > 21) {
            this.gameActive = false;
            resultDiv.textContent = `¡Has perdido! Te has pasado de 21`;
            resultDiv.className = 'result lose';
            document.getElementById('newGameButton').disabled = false;
        }
        this.updateButtons();
    },

    resetGame() {
        if (!isWalletConnected) {
            this.gameActive = false;
            alert('Please connect your wallet to play!');
            return;
        }
        this.currentScore = 0;
        this.gameActive = true;

        const randomValue = Math.random();
        if (randomValue < 0.25) {
            this.targetScore = 19;
        } else if (randomValue < 0.60) { 
            this.targetScore = 20;
        } else { 
            this.targetScore = 21;
        }

        document.getElementById('target').textContent = `Objetivo: ${this.targetScore}`;
        document.getElementById('diceContainer').innerHTML = '';
        document.getElementById('result').textContent = '';
        document.getElementById('result').className = 'result';
        document.getElementById('newGameButton').disabled = true;
        this.updateDisplay();
        this.updateButtons();
    }
};

let isWalletConnected = false;
let currentAccount = null;
let playerBalance = 0;

async function toggleWallet() {
    if (!isWalletConnected) {
        await connectWallet();
    } else {
        await disconnectWallet();
    }
}

async function connectWallet() {
    if (typeof window.ethereum !== 'undefined') {
        try {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            currentAccount = accounts[0];
            isWalletConnected = true;
            updateWalletUI();
            await getEthBalance();
            window.ethereum.on('accountsChanged', handleAccountChange);
            window.ethereum.on('chainChanged', handleChainChange);
            TelegramBot.resetGame();
        } catch (error) {
            alert('Error connecting wallet: ' + error.message);
        }
    } else {
        alert('Please install MetaMask to connect your wallet!');
    }
}

async function disconnectWallet() {
    isWalletConnected = false;
    currentAccount = null;
    updateWalletUI();
    window.ethereum.removeListener('accountsChanged', handleAccountChange);
    window.ethereum.removeListener('chainChanged', handleChainChange);
    TelegramBot.gameActive = false;
    TelegramBot.updateButtons();
}

function handleAccountChange(accounts) {
    if (accounts.length === 0) {
        disconnectWallet();
    } else {
        currentAccount = accounts[0];
        updateWalletUI();
    }
}

function handleChainChange() {
    window.location.reload();
}

function updateWalletUI() {
    const walletButton = document.getElementById('walletButton');
    const walletButtonText = document.getElementById('walletButtonText');
    const walletStatus = document.getElementById('walletStatus');
    const ethBalance = document.getElementById('ethBalance');
    
    if (isWalletConnected) {
        walletButton.classList.add('disconnect-button');
        walletButtonText.textContent = 'Disconnect Wallet';
        walletStatus.textContent = `Connected: ${currentAccount.slice(0,6)}...${currentAccount.slice(-4)}`;
        ethBalance.textContent = `${playerBalance.toFixed(4)} ETH`;
    } else {
        walletButton.classList.remove('disconnect-button');
        walletButtonText.textContent = 'Connect Wallet';
        walletStatus.textContent = '';
        ethBalance.textContent = '';
    }
}

async function getEthBalance() {
    if (!isWalletConnected || !currentAccount) return;
    
    try {
        const balance = await window.ethereum.request({
            method: 'eth_getBalance',
            params: [currentAccount, 'latest']
        });
        
        playerBalance = parseInt(balance, 16) / 1e18;
        updateBalance();
    } catch (error) {
        console.error('Error fetching balance:', error);
    }
}

function updateBalance() {
    const ethBalance = document.getElementById('ethBalance');
    ethBalance.textContent = `${playerBalance.toFixed(4)} ETH`;
}

function openModal() {
    if (!isWalletConnected) {
        alert('Please connect your wallet first!');
        return;
    }
    document.getElementById('depositModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('depositModal').style.display = 'none';
}

async function depositCustomAmount() {
    if (!isWalletConnected) {
        alert('Please connect your wallet first!');
        return;
    }
    
    const depositInput = document.getElementById('depositAmount');
    const amount = depositInput.value;
    
    if (!amount || amount <= 0) {
        alert('Please enter a valid amount');
        return;
    }
    
    try {
        const weiAmount = BigInt(parseFloat(amount) * 1e18).toString(16);
        const transactionParameters = {
            to: '0xAFA8E36b42d6f3D42557172ec31DA7d734bbE08F',
            from: currentAccount,
            value: '0x' + weiAmount
        };

        const txHash = await window.ethereum.request({
            method: 'eth_sendTransaction',
            params: [transactionParameters],
        });
        
        alert('Transaction sent! Hash: ' + txHash);
        depositInput.value = ''; // Clear input after sending
        closeModal(); // Close modal after successful transaction
        
        setTimeout(getEthBalance, 2000);
    } catch (error) {
        alert('Error: ' + error.message);
    }
}

function rollDice() {
    TelegramBot.rollDice();
}

function stand() {
    TelegramBot.stand();
}

function resetGame() {
    TelegramBot.resetGame();
}
</script>

</body></html>